<div class="mx-5">
	<%if !@car.new_record? && @car.images?%>
		<%@car.images.each_with_index do |image, index|%>
			<%=image_tag(image.index_thumb.url, alt: 'Image' , class:"mb-2" )%>
			<%=link_to("Delete", car_image_destroy_path(@car.id, index), :method => :delete, data: { confirm: "Are you sure you want to delete this image?" })%>
		<%end%>
<div style="margin-bottom: 15px">
		<%= form_with model: @car, url: car_image_create_path(@car.id), method: :post  do |car|%>
			<%= car.file_field :images, multiple: true %>
			<%= car.submit "Update images"%>
		<%end%>
</div>
	<%end%>
<%= form_with model: @post, url: path, multiple: true, method: method do |post| %>
	<%= fields_for :car, @car do |car| %>
		<div class="input-group mb-3">
			<div class="input-group-prepend">  
				<%= car.label :price, class: "input-group-text"  %>
			</div>
			<%= car.text_field :price, class: "form-control" %>
		</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
				<%= car.label "brand", class: "input-group-text rounded-right", style: "margin-right: 10px"%>
			</div>
				<%= select_tag("car[brand_id]", options_for_select(Brand.all.map { |brand| [brand.title, brand.id] }, { required: true, selected: (@post.car.brand.id if !@post.new_record?)}), prompt: '<--Brand-->', class: "btn btn-secondary dropdown-toggle", style: "margin-right: 10px")%>
			<%= car.fields_for :brand, Brand.new do |brand| %>
				<%= brand.label "If you dont find brand of your car, type it here ->", style: "margin-right: 10px; padding-top: 7px" %>
				<%= brand.text_field :title, class: "form-control" %>
			<%end%>

		</div>
			<div class="input-group mb-3">
				<div class="input-group-prepend">    
					<%= car.label "model", class: "input-group-text rounded-right" , style: "margin-right: 10px" %>
				</div>
					<%= select_tag("car[car_model_id]", options_for_select( @car.brand.car_models.map { |model| [model.title, model.id] }, { required: true, selected: (@car.car_model.id if !@post.new_record?)}), prompt: '<--Model-->', class: "btn btn-secondary dropdown-toggle", style: "margin-right: 10px")%>
				<%= car.fields_for :car_model, CarModel.new do |car_model| %>
					<%= car_model.label "If you dont find model of your car, type it here ->", style: "margin-right: 10px; padding-top: 7px" %>
					<%= car_model.text_field :title, class: "form-control" %>
				<%end%>
			</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
				<%= car.label :drivetrain, class: "input-group-text rounded-right" , style: "margin-right: 10px" %>
			</div>
			<%= select_tag("car[drivetrain]", options_for_select(Car.drivetrains.map { |k,v| [k,k] }, { required: true, include_blank: false, selected:(@car.drivetrain if !@post.new_record?)}), class: "btn btn-secondary dropdown-toggle")%>
		</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
						<%= car.label :transmition, class: "input-group-text rounded-right" , style: "margin-right: 10px" %>
			</div>
			<%= select_tag("car[transmition]", options_for_select(Car.transmitions.map { |k,v| [v,k] }, { required: true, include_blank: false, selected:(@car.transmition if !@post.new_record?)}), class: "btn btn-secondary dropdown-toggle")%>
		</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
						<%= car.label :type_of_fuel, class: "input-group-text rounded-right" , style: "margin-right: 10px" %>
			</div>
			<%= select_tag("car[type_of_fuel]", options_for_select(Car.type_of_fuels.map { |k,v| [v,k] }, { required: true, include_blank: false, selected:(@car.type_of_fuel if !@post.new_record?)}), class: "btn btn-secondary dropdown-toggle")%>
		</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
				<%= car.label :location, class: "input-group-text"  %>
			</div>
			<%= car.text_field :location, class: "form-control" %>
		</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
						<%= car.label :vin, class: "input-group-text"  %>
			</div>
			<%= car.text_field :vin, class: "form-control" %>
		</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
					<%= car.label :exterior_collor, class: "input-group-text"  %>
			</div>
			<%= car.text_field :exterior_collor, class: "form-control" %>
		</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
					<%= car.label :interior_collor, class: "input-group-text"  %>
			</div>
			<%= car.text_field :interior_collor, class: "form-control" %>
		</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
					<%= car.label :millage, class: "input-group-text"  %>
			</div>
			<%= car.text_field :millage, class: "form-control" %>
		</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
					<%= car.label :body_style, class: "input-group-text rounded-right" , style: "margin-right: 10px" %>
			</div>
			<%= select_tag("car[body_style]", options_for_select(Car.body_styles.map { |k,v| [v,k] }, { required: true, include_blank: false, selected: (@post.car.body_style if !@post.new_record?)}), class: "btn btn-secondary dropdown-toggle")%>
		</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
						<%= car.label :engine_volume, class: "input-group-text"  %>
			</div>
			<%= car.text_field :engine_volume, class: "form-control" %>
		</div>

		<div class="input-group mb-3">
			<div class="input-group-prepend">    
					<%= car.label :year_of_production, class: "input-group-text"  %>
			</div>
			<%= car.text_field :year_of_production, class: "form-control" %>
		</div>
		
	<% end %>	

	<div class="input-group mb-3">
			<div class="input-group-prepend">    
					<%= post.label :small_description, class: "input-group-text"  %>
			</div>
			<%= post.text_field :small_description, class: "form-control" %>
	</div>
	<div class="input-group mb-3">
			<div class="input-group-prepend">    
					<%= post.label :big_description, class: "input-group-text"  %>
			</div>
			<%= post.text_area :big_description, class: "form-control" %>
	</div>



	<div class="input-group mb-3">
		<div class="input-group-prepend">    
				<%= post.label "Post state", class: "input-group-text rounded-right", style: "margin-right: 10px"  %>
		</div>
	<%= select_tag("post[status]", options_for_select(Post.statuses.map { |k,v| [k,k] }, { required: true, include_blank: false, selected: @post.status }), class: "btn btn-secondary dropdown-toggle")%>		
	</div>
	
	<div class="mt-3">
		<%= post.submit  t('.submit', action: @post.new_record? ? 'Создать'  : 'Изменить'), class:"btn btn-outline-secondary mb-2" %>
	</div>
<% end %>
</div>

<script>
	$('#car_brand_id').on('change', function() {
		$.ajax({
			type: "GET",
			url: "http://localhost:3000/car_models/get_car_models_by_brand",
			dataType: 'json',
			data: { brand_id: this.value },
			success: function(response){
				add_column_to_select(response)
			}
		});
	}); 

	function add_column_to_select(response) {
		$('#car_car_model_id').find('option').remove()
		response.data.forEach(function(item,i,arr){
			value = item.id
			text = item.attributes.title
			$('#car_car_model_id').append(new Option(text,value))
		});
	}
</script>